"use client"

import React, { useState, useEffect } from 'react';
import dynamic from 'next/dynamic'

const ReactApexChart = dynamic(() => import('react-apexcharts'), { ssr: false });

const Chart = ({ timeline }) => {
    const [chartData, setChartData] = useState({
        series: [{
            name: "Profit Percentage",
            data: [
                {
                    "x": "01-07-2016 00:00",
                    "y": 30.53100014
                },
                {
                    "x": "01-07-2016 00:15",
                    "y": 30.45999908
                },
                {
                    "x": "01-07-2016 00:30",
                    "y": 30.03800011
                },
                {
                    "x": "01-07-2016 00:45",
                    "y": 27.01300049
                },
                {
                    "x": "01-07-2016 01:00",
                    "y": 27.78700066
                },
                {
                    "x": "01-07-2016 01:15",
                    "y": 27.71699905
                },
                {
                    "x": "01-07-2016 01:30",
                    "y": 27.64599991
                },
                {
                    "x": "01-07-2016 01:45",
                    "y": 27.08399963
                },
                {
                    "x": "01-07-2016 02:00",
                    "y": 27.78700066
                },
                {
                    "x": "01-07-2016 02:15",
                    "y": 27.50600052
                },
                {
                    "x": "01-07-2016 02:30",
                    "y": 27.85700035
                },
                {
                    "x": "01-07-2016 02:45",
                    "y": 27.01300049
                },
                {
                    "x": "01-07-2016 03:00",
                    "y": 25.04400063
                },
                {
                    "x": "01-07-2016 03:15",
                    "y": 24.5510006
                },
                {
                    "x": "01-07-2016 03:30",
                    "y": 23.56599998
                },
                {
                    "x": "01-07-2016 03:45",
                    "y": 21.52599907
                },
                {
                    "x": "01-07-2016 04:00",
                    "y": 21.94799995
                },
                {
                    "x": "01-07-2016 04:15",
                    "y": 21.45599937
                },
                {
                    "x": "01-07-2016 04:30",
                    "y": 22.79199982
                },
                {
                    "x": "01-07-2016 04:45",
                    "y": 21.0340004
                },
                {
                    "x": "01-07-2016 05:00",
                    "y": 21.17399979
                },
                {
                    "x": "01-07-2016 05:15",
                    "y": 20.82299995
                },
                {
                    "x": "01-07-2016 05:30",
                    "y": 21.17399979
                },
                {
                    "x": "01-07-2016 05:45",
                    "y": 21.17399979
                },
                {
                    "x": "01-07-2016 06:00",
                    "y": 22.79199982
                },
                {
                    "x": "01-07-2016 06:15",
                    "y": 23.84799957
                },
                {
                    "x": "01-07-2016 06:30",
                    "y": 24.34000015
                },
                {
                    "x": "01-07-2016 06:45",
                    "y": 23.1439991
                },
                {
                    "x": "01-07-2016 07:00",
                    "y": 23.1439991
                },
                {
                    "x": "01-07-2016 07:15",
                    "y": 23.77700043
                },
                {
                    "x": "01-07-2016 07:30",
                    "y": 23.84799957
                },
                {
                    "x": "01-07-2016 07:45",
                    "y": 23.98800087
                },
                {
                    "x": "01-07-2016 08:00",
                    "y": 21.66699982
                },
                {
                    "x": "01-07-2016 08:15",
                    "y": 22.0890007
                },
                {
                    "x": "01-07-2016 08:30",
                    "y": 22.37000084
                },
                {
                    "x": "01-07-2016 08:45",
                    "y": 16.39100075
                },
                {
                    "x": "01-07-2016 09:00",
                    "y": 17.44599915
                },
                {
                    "x": "01-07-2016 09:15",
                    "y": 17.72699928
                },
                {
                    "x": "01-07-2016 09:30",
                    "y": 18.50099945
                },
                {
                    "x": "01-07-2016 09:45",
                    "y": 19.27499962
                },
                {
                    "x": "01-07-2016 10:00",
                    "y": 19.97900009
                },
                {
                    "x": "01-07-2016 10:15",
                    "y": 18.50099945
                },
                {
                    "x": "01-07-2016 10:30",
                    "y": 18.5720005
                },
                {
                    "x": "01-07-2016 10:45",
                    "y": 19.41600037
                },
                {
                    "x": "01-07-2016 11:00",
                    "y": 20.11899948
                },
                {
                    "x": "01-07-2016 11:15",
                    "y": 19.76799965
                },
                {
                    "x": "01-07-2016 11:30",
                    "y": 19.76799965
                },
                {
                    "x": "01-07-2016 11:45",
                    "y": 20.32999992
                },
                {
                    "x": "01-07-2016 12:00",
                    "y": 19.20499992
                },
                {
                    "x": "01-07-2016 12:15",
                    "y": 17.72699928
                },
                {
                    "x": "01-07-2016 12:30",
                    "y": 18.6420002
                },
                {
                    "x": "01-07-2016 12:45",
                    "y": 18.50099945
                },
                {
                    "x": "01-07-2016 13:00",
                    "y": 18.5720005
                },
                {
                    "x": "01-07-2016 13:15",
                    "y": 19.6970005
                },
                {
                    "x": "01-07-2016 13:30",
                    "y": 19.55599976
                },
                {
                    "x": "01-07-2016 13:45",
                    "y": 19.83799934
                },
                {
                    "x": "01-07-2016 14:00",
                    "y": 19.55599976
                },
                {
                    "x": "01-07-2016 14:15",
                    "y": 19.41600037
                },
                {
                    "x": "01-07-2016 14:30",
                    "y": 19.13400078
                },
                {
                    "x": "01-07-2016 14:45",
                    "y": 17.02400017
                },
                {
                    "x": "01-07-2016 15:00",
                    "y": 17.30500031
                },
                {
                    "x": "01-07-2016 15:15",
                    "y": 18.78300095
                },
                {
                    "x": "01-07-2016 15:30",
                    "y": 18.85300064
                },
                {
                    "x": "01-07-2016 15:45",
                    "y": 19.20499992
                },
                {
                    "x": "01-07-2016 16:00",
                    "y": 19.48600006
                },
                {
                    "x": "01-07-2016 16:15",
                    "y": 19.62700081
                },
                {
                    "x": "01-07-2016 16:30",
                    "y": 18.43099976
                },
                {
                    "x": "01-07-2016 16:45",
                    "y": 19.76799965
                },
                {
                    "x": "01-07-2016 17:00",
                    "y": 19.13400078
                },
                {
                    "x": "01-07-2016 17:15",
                    "y": 20.75200081
                },
                {
                    "x": "01-07-2016 17:30",
                    "y": 19.76799965
                },
                {
                    "x": "01-07-2016 17:45",
                    "y": 20.68199921
                },
                {
                    "x": "01-07-2016 18:00",
                    "y": 20.68199921
                },
                {
                    "x": "01-07-2016 18:15",
                    "y": 19.83799934
                },
                {
                    "x": "01-07-2016 18:30",
                    "y": 19.20499992
                },
                {
                    "x": "01-07-2016 18:45",
                    "y": 19.41600037
                },
                {
                    "x": "01-07-2016 19:00",
                    "y": 18.71199989
                },
                {
                    "x": "01-07-2016 19:15",
                    "y": 17.86800003
                },
                {
                    "x": "01-07-2016 19:30",
                    "y": 18.21999931
                },
                {
                    "x": "01-07-2016 19:45",
                    "y": 18.50099945
                },
                {
                    "x": "01-07-2016 20:00",
                    "y": 17.86800003
                },
                {
                    "x": "01-07-2016 20:15",
                    "y": 18.21999931
                },
                {
                    "x": "01-07-2016 20:30",
                    "y": 17.86800003
                },
                {
                    "x": "01-07-2016 20:45",
                    "y": 17.86800003
                },
                {
                    "x": "01-07-2016 21:00",
                    "y": 18.00900078
                },
                {
                    "x": "01-07-2016 21:15",
                    "y": 18.36100006
                },
                {
                    "x": "01-07-2016 21:30",
                    "y": 18.6420002
                },
                {
                    "x": "01-07-2016 21:45",
                    "y": 18.00900078
                },
                {
                    "x": "01-07-2016 22:00",
                    "y": 18.00900078
                },
                {
                    "x": "01-07-2016 22:15",
                    "y": 17.58699989
                },
                {
                    "x": "01-07-2016 22:30",
                    "y": 18.29000092
                },
                {
                    "x": "01-07-2016 22:45",
                    "y": 19.41600037
                },
                {
                    "x": "01-07-2016 23:00",
                    "y": 19.76799965
                },
                {
                    "x": "01-07-2016 23:15",
                    "y": 20.75200081
                },
                {
                    "x": "01-07-2016 23:30",
                    "y": 21.31500053
                },
                {
                    "x": "01-07-2016 23:45",
                    "y": 21.87800026
                },
            ],
        }],
        options: {
            chart: {
                id: 'area-datetime',
                type: 'area',
                height: 350,
                zoom: {
                    autoScaleYaxis: true,
                },
            },
            annotations: {
                yaxis: [{
                    y: 30,
                    borderColor: '#999',
                }],
                xaxis: [{
                    x: new Date('01 July 2016').getTime(),
                    borderColor: '#999',
                    yAxisIndex: 0,
                }]
            },
            dataLabels: {
                enabled: false,
            },
            markers: {
                size: 0,
                style: 'hollow',
            },
            colors: ["#25CD25"],
            stroke: {
                width: 2,
                dashArray: [5, 5],
            },
            xaxis: {
                type: 'datetime',
                tickAmount: 20,
            },
            labels: {
                formatter: (value) => value.toFixed(3),
            },
            tooltip: {
                x: {
                    format: 'dd MM yyyy',
                },
            },
            zoom: {
                enabled: true
            },
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.9,
                    stops: [0, 100],
                    colorStops: [
                        {
                            offset: 0,
                            color: 'rgba(37, 205, 37, 0.40)',
                        },
                        {
                            offset: 100,
                            color: 'rgba(37, 205, 37, 0.00)',
                        },
                    ],
                },
            },
        },
    });

    useEffect(() => {
        const fetchData = async () => {
            try {
                const res = await fetch("/api", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        "timeline": timeline
                    })
                });

                const profitData = await res.json();

                setChartData(prevChartData => ({
                    ...prevChartData,
                    series: [{
                        ...prevChartData.series[0],
                        data: profitData.data,
                    }],
                }));

            } catch (error) {
                console.error("Error fetching data:", error);
            }

        }

        fetchData();
    }, [timeline]);

    return (
        <div>
            <div id="chart">
                <div id="chart-timeline">
                    <ReactApexChart options={chartData.options} series={chartData.series} type="area" height={250} width="100%" />
                </div>
            </div>
            <div id="html-dist"></div>
        </div>
    );
};


export default Chart;